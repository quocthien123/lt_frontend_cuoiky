{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 124, "column": 0}, "map": {"version":3,"sources":["file:///D:/1ky-1-nam-4/frontend_cuoiky/frontend_backend_news/src/app/api/lichthidau/lich-thi-dau.ts"],"sourcesContent":["import axios from 'axios';\r\n\r\n// types.ts hoặc ngay trong file\r\ninterface MatchItem {\r\n  round_name: string;\r\n  home_name: string;\r\n  home_logo: string;\r\n  away_name: string;\r\n  away_logo: string;\r\n  start_time: number; // hoặc string, tuỳ API\r\n  goals_home: string | null;\r\n  goals_away: string | null;\r\n  status: string;\r\n}\r\n\r\n\r\nconst LEAGUES = [\r\n  { id: 'premier-league', name: 'Ngoại Hạng Anh', url: `https://data.bongdaplus.vn/data/bong-da-anh-matches.json?_=${Date.now()}` },\r\n  { id: 'la-liga', name: 'Tây Ban Nha', url: `https://data.bongdaplus.vn/data/bong-da-tay-ban-nha-matches.json?_=${Date.now()}` },\r\n  { id: 'v-league', name: 'V-League', url: `https://data.bongdaplus.vn/data/bong-da-viet-nam-matches.json?_=${Date.now()}` },\r\n  { id: 'bundesliga', name: 'Đức', url: `https://data.bongdaplus.vn/data/bong-da-duc-matches.json?_=${Date.now()}` },\r\n  { id: 'league-1', name: 'Pháp', url: `https://data.bongdaplus.vn/data/bong-da-phap-matches.json?_=${Date.now()}` },\r\n  { id: 'serie-A', name: 'Ý', url: `https://data.bongdaplus.vn/data/bong-da-y-matches.json?_=${Date.now()}` },\r\n  { id: 'champion-league', name: \"C1\", url: `https://data.bongdaplus.vn/data/champions-league-cup-c1-matches.json?_=${Date.now()}` }\r\n];\r\n\r\nfunction getDateString(timestamp: any): string {\r\n    try {\r\n      return timestamp.split(' ')[0]\r\n    }\r\n    catch {\r\n      return \"unknown\"\r\n    }\r\n}\r\nfunction groupBy<T>(\r\n  array: T[],\r\n  keyFn: (item: T) => string\r\n) {\r\n  const result: Record<string, T[]> = {};\r\n\r\n  for (const item of array) {\r\n    const key = keyFn(item);\r\n\r\n    if (!result[key]) {\r\n      result[key] = [];\r\n    }\r\n\r\n    result[key].push(item);\r\n  }\r\n\r\n  return result;\r\n}\r\n\r\n\r\nexport async function fetchLeaguesMatches() {\r\n  try {\r\n    const requests = LEAGUES.map(async (league) => {\r\n      try {\r\n        const response = await axios.get(league.url);\r\n        const rawData = response.data;\r\n       const matches = (rawData.matches as any[]).map(item => ({\r\n            round_name: item.round_name,\r\n            home_name: item.home_name,\r\n            home_logo: `https://data.bongdaplus.vn/logo/${item.home_logo}`,\r\n            away_name: item.away_name,\r\n            away_logo: `https://data.bongdaplus.vn/logo/${item.away_logo}`,\r\n            start_time: item.start_time,\r\n            goals_home: item.goals_home,\r\n            goals_away: item.goals_away,\r\n            status: item.status,\r\n          })) as MatchItem[];\r\n          console.log(matches)\r\n        // --- Bắt đầu nhóm dữ liệu ---\r\n        // 1. Nhóm theo round_name\r\n        const roundsMap = groupBy(matches, (m) => m.round_name);\r\n\r\n        // 2. Với mỗi vòng, nhóm tiếp theo ngày\r\n        const rounds = Object.entries(roundsMap).map(([roundName, roundMatches]) => {\r\n          const datesMap = groupBy(roundMatches, (m) => getDateString(m.start_time));\r\n          const dates = Object.entries(datesMap).map(([date, matchesInDate]) => ({\r\n            date,\r\n            matches: matchesInDate\r\n          }));\r\n          return {\r\n            round_name: roundName,\r\n            dates\r\n          };\r\n        });\r\n\r\n        return {\r\n          league_id: league.id,\r\n          league_name: league.name,\r\n          rounds\r\n        };\r\n      } catch (err) {\r\n        console.warn(`Lỗi khi fetch giải: ${league.name}`, err);\r\n        return {\r\n          league_id: league.id,\r\n          league_name: league.name,\r\n          rounds: []\r\n        };\r\n      }\r\n    });\r\n\r\n    const finalData = await Promise.all(requests);\r\n    return finalData;\r\n  } catch (error) {\r\n    console.error(\"Lỗi hệ thống tổng thể:\", error);\r\n    return [];\r\n  }\r\n}"],"names":[],"mappings":";;;;AAAA;;AAgBA,MAAM,UAAU;IACd;QAAE,IAAI;QAAkB,MAAM;QAAkB,KAAK,CAAC,2DAA2D,EAAE,KAAK,GAAG,IAAI;IAAC;IAChI;QAAE,IAAI;QAAW,MAAM;QAAe,KAAK,CAAC,mEAAmE,EAAE,KAAK,GAAG,IAAI;IAAC;IAC9H;QAAE,IAAI;QAAY,MAAM;QAAY,KAAK,CAAC,gEAAgE,EAAE,KAAK,GAAG,IAAI;IAAC;IACzH;QAAE,IAAI;QAAc,MAAM;QAAO,KAAK,CAAC,2DAA2D,EAAE,KAAK,GAAG,IAAI;IAAC;IACjH;QAAE,IAAI;QAAY,MAAM;QAAQ,KAAK,CAAC,4DAA4D,EAAE,KAAK,GAAG,IAAI;IAAC;IACjH;QAAE,IAAI;QAAW,MAAM;QAAK,KAAK,CAAC,yDAAyD,EAAE,KAAK,GAAG,IAAI;IAAC;IAC1G;QAAE,IAAI;QAAmB,MAAM;QAAM,KAAK,CAAC,uEAAuE,EAAE,KAAK,GAAG,IAAI;IAAC;CAClI;AAED,SAAS,cAAc,SAAc;IACjC,IAAI;QACF,OAAO,UAAU,KAAK,CAAC,IAAI,CAAC,EAAE;IAChC,EACA,OAAM;QACJ,OAAO;IACT;AACJ;AACA,SAAS,QACP,KAAU,EACV,KAA0B;IAE1B,MAAM,SAA8B,CAAC;IAErC,KAAK,MAAM,QAAQ,MAAO;QACxB,MAAM,MAAM,MAAM;QAElB,IAAI,CAAC,MAAM,CAAC,IAAI,EAAE;YAChB,MAAM,CAAC,IAAI,GAAG,EAAE;QAClB;QAEA,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC;IACnB;IAEA,OAAO;AACT;AAGO,eAAe;IACpB,IAAI;QACF,MAAM,WAAW,QAAQ,GAAG,CAAC,OAAO;YAClC,IAAI;gBACF,MAAM,WAAW,MAAM,2KAAK,CAAC,GAAG,CAAC,OAAO,GAAG;gBAC3C,MAAM,UAAU,SAAS,IAAI;gBAC9B,MAAM,UAAU,AAAC,QAAQ,OAAO,CAAW,GAAG,CAAC,CAAA,OAAQ,CAAC;wBACnD,YAAY,KAAK,UAAU;wBAC3B,WAAW,KAAK,SAAS;wBACzB,WAAW,CAAC,gCAAgC,EAAE,KAAK,SAAS,EAAE;wBAC9D,WAAW,KAAK,SAAS;wBACzB,WAAW,CAAC,gCAAgC,EAAE,KAAK,SAAS,EAAE;wBAC9D,YAAY,KAAK,UAAU;wBAC3B,YAAY,KAAK,UAAU;wBAC3B,YAAY,KAAK,UAAU;wBAC3B,QAAQ,KAAK,MAAM;oBACrB,CAAC;gBACD,QAAQ,GAAG,CAAC;gBACd,+BAA+B;gBAC/B,0BAA0B;gBAC1B,MAAM,YAAY,QAAQ,SAAS,CAAC,IAAM,EAAE,UAAU;gBAEtD,uCAAuC;gBACvC,MAAM,SAAS,OAAO,OAAO,CAAC,WAAW,GAAG,CAAC,CAAC,CAAC,WAAW,aAAa;oBACrE,MAAM,WAAW,QAAQ,cAAc,CAAC,IAAM,cAAc,EAAE,UAAU;oBACxE,MAAM,QAAQ,OAAO,OAAO,CAAC,UAAU,GAAG,CAAC,CAAC,CAAC,MAAM,cAAc,GAAK,CAAC;4BACrE;4BACA,SAAS;wBACX,CAAC;oBACD,OAAO;wBACL,YAAY;wBACZ;oBACF;gBACF;gBAEA,OAAO;oBACL,WAAW,OAAO,EAAE;oBACpB,aAAa,OAAO,IAAI;oBACxB;gBACF;YACF,EAAE,OAAO,KAAK;gBACZ,QAAQ,IAAI,CAAC,CAAC,oBAAoB,EAAE,OAAO,IAAI,EAAE,EAAE;gBACnD,OAAO;oBACL,WAAW,OAAO,EAAE;oBACpB,aAAa,OAAO,IAAI;oBACxB,QAAQ,EAAE;gBACZ;YACF;QACF;QAEA,MAAM,YAAY,MAAM,QAAQ,GAAG,CAAC;QACpC,OAAO;IACT,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,0BAA0B;QACxC,OAAO,EAAE;IACX;AACF"}},
    {"offset": {"line": 243, "column": 0}, "map": {"version":3,"sources":["file:///D:/1ky-1-nam-4/frontend_cuoiky/frontend_backend_news/src/app/api/lichthidau/route.ts"],"sourcesContent":["// src/app/api/bongdaplus/route.ts\r\nimport { NextRequest, NextResponse } from 'next/server';\r\nimport { fetchLeaguesMatches } from './lich-thi-dau';\r\n\r\n//dinh nghia cors\r\nconst corsHeaders = {\r\n  'Access-Control-Allow-Origin': '*', // Cho phép tất cả các domain (localhost:5173, v.v...)\r\n  'Access-Control-Allow-Methods': 'GET, POST, PUT, DELETE, OPTIONS',\r\n  'Access-Control-Allow-Headers': 'Content-Type, Authorization',\r\n  'Cache-Control': 's-maxage=600', // Giữ nguyên cache của bạn\r\n};\r\nexport async function GET(request: NextRequest) {\r\n  try {\r\n    const res = await fetch('https://bongdaplus.vn', {\r\n      headers: { 'User-Agent': 'Mozilla/5.0 (compatible; BongDaPlus Scraper)' },\r\n    });\r\n\r\n    if (!res.ok) throw new Error(`Fetch failed: ${res.status}`);\r\n    const matches = await fetchLeaguesMatches();\r\n    return Response.json(\r\n      {\r\n        success: true,\r\n        data: {\r\n          matches\r\n        },\r\n      },\r\n      {status : 200,\r\n        headers : corsHeaders\r\n      }\r\n    );\r\n  } catch (error) {\r\n    console.log(\"lỗi header : \", error)\r\n    return Response.json(\r\n      {\r\n        success: false,\r\n        error: (error as Error).message,\r\n      },\r\n      { status: 500, \r\n        headers: corsHeaders\r\n      }\r\n    );\r\n  }\r\n}"],"names":[],"mappings":"AAAA,kCAAkC;;;;;AAElC;;AAEA,iBAAiB;AACjB,MAAM,cAAc;IAClB,+BAA+B;IAC/B,gCAAgC;IAChC,gCAAgC;IAChC,iBAAiB;AACnB;AACO,eAAe,IAAI,OAAoB;IAC5C,IAAI;QACF,MAAM,MAAM,MAAM,MAAM,yBAAyB;YAC/C,SAAS;gBAAE,cAAc;YAA+C;QAC1E;QAEA,IAAI,CAAC,IAAI,EAAE,EAAE,MAAM,IAAI,MAAM,CAAC,cAAc,EAAE,IAAI,MAAM,EAAE;QAC1D,MAAM,UAAU,MAAM,IAAA,uMAAmB;QACzC,OAAO,SAAS,IAAI,CAClB;YACE,SAAS;YACT,MAAM;gBACJ;YACF;QACF,GACA;YAAC,QAAS;YACR,SAAU;QACZ;IAEJ,EAAE,OAAO,OAAO;QACd,QAAQ,GAAG,CAAC,iBAAiB;QAC7B,OAAO,SAAS,IAAI,CAClB;YACE,SAAS;YACT,OAAO,AAAC,MAAgB,OAAO;QACjC,GACA;YAAE,QAAQ;YACR,SAAS;QACX;IAEJ;AACF"}}]
}