{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 274, "column": 0}, "map": {"version":3,"sources":["file:///D:/1ky-1-nam-4/frontend_cuoiky/frontend_backend_news/src/app/api/get-category/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\r\nimport * as cheerio from 'cheerio';\r\nimport { Article } from '../bongdaplus/types';\r\nimport axios from 'axios';\r\n\r\n// Headers để tránh lỗi CORS\r\nconst corsHeaders = {\r\n  'Access-Control-Allow-Origin': '*',\r\n  'Access-Control-Allow-Methods': 'GET, OPTIONS',\r\n  'Access-Control-Allow-Headers': 'Content-Type, Authorization',\r\n};\r\n\r\nexport interface Article_News {\r\n    title: string,\r\n    img_url: string,\r\n    dateTime : string,\r\n    url : string,\r\n}\r\n\r\nexport async function GET(request: NextRequest) {\r\n    try {\r\n  const searchParams = request.nextUrl.searchParams;\r\n  const slug = searchParams.get('slug');\r\n  if (!slug) {\r\n    return NextResponse.json(\r\n      { success: false, message: 'Thiếu slug' },\r\n      { status: 400, headers: corsHeaders }\r\n    );\r\n  }\r\n        //https://bongdaplus.vn/bong-da-viet-nams\r\n  const urlToScrape = `https://bongdaplus.vn/${slug}`;\r\n  const rankingUrl = `https://data.bongdaplus.vn/data/${slug}-rankings.json?_=${Date.now()}`\r\n  console.log(`Đang cào dữ liệu từ: ${urlToScrape}`);\r\nconst res = await fetch(urlToScrape, {\r\n      headers: { 'User-Agent': 'Mozilla/5.0 (compatible; MyScraper)' },\r\n    });\r\n\r\n    if (!res.ok) throw new Error('Không thể truy cập trang đích');\r\n  const html = await res.text();\r\n    const $ = cheerio.load(html);\r\n\r\n    const articles_news: Article_News[] = []\r\n      const standing = await leagueRanking(rankingUrl)\r\n    $('.cat-news .news').each((i, el) => {\r\n        \r\n        const $el = $(el)\r\n\r\n        const title = $el.find('a.title').text()\r\n\r\n        const img_url = $el.find('.thumb img').attr('src') || ''\r\n\r\n        const  dateTime = $el.find('.info span').text()\r\n\r\n        const url = $el.find('a.title').attr('href') \r\n\r\n        articles_news.push({\r\n            title,\r\n            img_url,\r\n            dateTime,\r\n            url,\r\n        })\r\n    })\r\n      return NextResponse.json(\r\n      {\r\n        success: true,\r\n        data: {\r\n            articles_news,\r\n            standing\r\n        },\r\n      },\r\n      {status : 200,\r\n        headers : corsHeaders\r\n      }\r\n    );\r\n  } catch (error) {\r\n    console.log(\"lỗi header : \", error)\r\n    return NextResponse.json(\r\n      {\r\n        success: false,\r\n        error: (error as Error).message,\r\n      },\r\n      { status: 500, \r\n        headers: corsHeaders\r\n      }\r\n    );\r\n  }\r\n}\r\n\r\nexport async function leagueRanking(leagueUrl : string) {\r\n        const response = await axios.get(leagueUrl);\r\n        const rawData = response.data;\r\n        const dataMap = rawData.ranks\r\n        const standings = dataMap.map(item => ({\r\n          nameTeam: item.team_name ,\r\n          teamLogo : `https://data.bongdaplus.vn/logo/${item.team_logo}` ,\r\n          rank : item.position,\r\n          matches : item.matches ,\r\n          win: item.wins ,\r\n          losses : item.losses ,\r\n          draws: item.draws,\r\n          ghiban : item.scores_for ,\r\n          thung_luoi : item.scores_against ,\r\n          hieu_so : item.scores_diff ,\r\n          point : item.points ,\r\n    }));\r\n    return {\r\n        standings: standings\r\n      };\r\n};\r\nexport async function OPTIONS() {\r\n  return NextResponse.json({}, { headers: corsHeaders });\r\n}"],"names":[],"mappings":";;;;;;;;AAAA;AACA;AAAA;AAEA;;;;AAEA,4BAA4B;AAC5B,MAAM,cAAc;IAClB,+BAA+B;IAC/B,gCAAgC;IAChC,gCAAgC;AAClC;AASO,eAAe,IAAI,OAAoB;IAC1C,IAAI;QACN,MAAM,eAAe,QAAQ,OAAO,CAAC,YAAY;QACjD,MAAM,OAAO,aAAa,GAAG,CAAC;QAC9B,IAAI,CAAC,MAAM;YACT,OAAO,yKAAY,CAAC,IAAI,CACtB;gBAAE,SAAS;gBAAO,SAAS;YAAa,GACxC;gBAAE,QAAQ;gBAAK,SAAS;YAAY;QAExC;QACM,yCAAyC;QAC/C,MAAM,cAAc,CAAC,sBAAsB,EAAE,MAAM;QACnD,MAAM,aAAa,CAAC,gCAAgC,EAAE,KAAK,iBAAiB,EAAE,KAAK,GAAG,IAAI;QAC1F,QAAQ,GAAG,CAAC,CAAC,qBAAqB,EAAE,aAAa;QACnD,MAAM,MAAM,MAAM,MAAM,aAAa;YAC/B,SAAS;gBAAE,cAAc;YAAsC;QACjE;QAEA,IAAI,CAAC,IAAI,EAAE,EAAE,MAAM,IAAI,MAAM;QAC/B,MAAM,OAAO,MAAM,IAAI,IAAI;QACzB,MAAM,IAAI,0LAAY,CAAC;QAEvB,MAAM,gBAAgC,EAAE;QACtC,MAAM,WAAW,MAAM,cAAc;QACvC,EAAE,mBAAmB,IAAI,CAAC,CAAC,GAAG;YAE1B,MAAM,MAAM,EAAE;YAEd,MAAM,QAAQ,IAAI,IAAI,CAAC,WAAW,IAAI;YAEtC,MAAM,UAAU,IAAI,IAAI,CAAC,cAAc,IAAI,CAAC,UAAU;YAEtD,MAAO,WAAW,IAAI,IAAI,CAAC,cAAc,IAAI;YAE7C,MAAM,MAAM,IAAI,IAAI,CAAC,WAAW,IAAI,CAAC;YAErC,cAAc,IAAI,CAAC;gBACf;gBACA;gBACA;gBACA;YACJ;QACJ;QACE,OAAO,yKAAY,CAAC,IAAI,CACxB;YACE,SAAS;YACT,MAAM;gBACF;gBACA;YACJ;QACF,GACA;YAAC,QAAS;YACR,SAAU;QACZ;IAEJ,EAAE,OAAO,OAAO;QACd,QAAQ,GAAG,CAAC,iBAAiB;QAC7B,OAAO,yKAAY,CAAC,IAAI,CACtB;YACE,SAAS;YACT,OAAO,AAAC,MAAgB,OAAO;QACjC,GACA;YAAE,QAAQ;YACR,SAAS;QACX;IAEJ;AACF;AAEO,eAAe,cAAc,SAAkB;IAC9C,MAAM,WAAW,MAAM,2KAAK,CAAC,GAAG,CAAC;IACjC,MAAM,UAAU,SAAS,IAAI;IAC7B,MAAM,UAAU,QAAQ,KAAK;IAC7B,MAAM,YAAY,QAAQ,GAAG,CAAC,CAAA,OAAQ,CAAC;YACrC,UAAU,KAAK,SAAS;YACxB,UAAW,CAAC,gCAAgC,EAAE,KAAK,SAAS,EAAE;YAC9D,MAAO,KAAK,QAAQ;YACpB,SAAU,KAAK,OAAO;YACtB,KAAK,KAAK,IAAI;YACd,QAAS,KAAK,MAAM;YACpB,OAAO,KAAK,KAAK;YACjB,QAAS,KAAK,UAAU;YACxB,YAAa,KAAK,cAAc;YAChC,SAAU,KAAK,WAAW;YAC1B,OAAQ,KAAK,MAAM;QACzB,CAAC;IACD,OAAO;QACH,WAAW;IACb;AACN;AACO,eAAe;IACpB,OAAO,yKAAY,CAAC,IAAI,CAAC,CAAC,GAAG;QAAE,SAAS;IAAY;AACtD"}}]
}