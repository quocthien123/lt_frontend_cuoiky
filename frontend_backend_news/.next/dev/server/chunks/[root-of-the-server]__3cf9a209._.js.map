{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 190, "column": 0}, "map": {"version":3,"sources":["file:///D:/1ky-1-nam-4/frontend_cuoiky/frontend_backend_news/src/app/api/videos/route.ts"],"sourcesContent":["import { NextRequest } from 'next/server';\r\nimport * as cheerio from 'cheerio';\r\n\r\ninterface VideoItem {\r\n  title: string;\r\n  img: string;\r\n  url: string;\r\n  timeLabel?: string;\r\n}\r\n\r\nexport async function GET(request: NextRequest) {\r\n  try {\r\n    const urlToScrape = 'https://bongdaplus.vn/video';\r\n    console.log(`Đang cào dữ liệu từ: ${urlToScrape}`);\r\n\r\n    const res = await fetch(urlToScrape, {\r\n      headers: { 'User-Agent': 'Mozilla/5.0 (compatible; MyScraper)' },\r\n    });\r\n\r\n    if (!res.ok) throw new Error(`HTTP ${res.status}: ${res.statusText}`);\r\n\r\n    const html = await res.text();\r\n    const $ = cheerio.load(html);\r\n\r\n    const result: {\r\n      highlights: VideoItem[];\r\n      diemTin: VideoItem[];\r\n      otherVideos: VideoItem[];\r\n    } = {\r\n      highlights: [],\r\n      diemTin: [],\r\n      otherVideos: [],\r\n    };\r\n\r\n    // Hàm helper chuẩn hóa URL\r\n    const normalizeUrl = (url: string): string => {\r\n      if (!url) return '';\r\n      const base = 'https://bongdaplus.vn';\r\n      return url.startsWith('http') ? url : base + (url.startsWith('/') ? url : '/' + url);\r\n    };\r\n\r\n    // Hàm trích xuất danh sách video từ một section theo tiêu đề\r\n    const extractVideosByCaption = (captionText: string): VideoItem[] => {\r\n      const section = $(`section.cat-news`).filter((_, el) => {\r\n        return $(el).find('.caption').text().trim() === captionText;\r\n      });\r\n\r\n      const items: VideoItem[] = [];\r\n      section.find('.row.flex .col .media').each((_, el) => {\r\n        const $el = $(el);\r\n        const $thumb = $el.find('a.thumb');\r\n        const title = $el.find('a.title').text().trim() || $thumb.find('img').attr('alt')?.trim() || '';\r\n        const img = $thumb.find('img').attr('src')?.trim() || '';\r\n        const url = $thumb.attr('href')?.trim() || '';\r\n        const timeLabel = $el.find('.info').first().text().trim() || undefined;\r\n\r\n        if (title && img && url) {\r\n          items.push({\r\n            title,\r\n            img: normalizeUrl(img),\r\n            url: normalizeUrl(url),\r\n            timeLabel,\r\n          });\r\n        }\r\n      });\r\n      return items;\r\n    };\r\n\r\n    // Trích xuất từng phần\r\n    result.highlights = extractVideosByCaption('Highlights');\r\n    result.diemTin = extractVideosByCaption('Điểm tin');\r\n    result.otherVideos = extractVideosByCaption('Video khác');\r\n\r\n    return new Response(JSON.stringify(result, null, 2), {\r\n      status: 200,\r\n      headers: { 'Content-Type': 'application/json; charset=utf-8' },\r\n    });\r\n  } catch (error) {\r\n    console.error('Lỗi khi cào dữ liệu:', error);\r\n    return new Response(\r\n      JSON.stringify({\r\n        error: 'Lỗi khi cào dữ liệu',\r\n        message: (error as Error).message,\r\n      }),\r\n      { status: 500, headers: { 'Content-Type': 'application/json; charset=utf-8' } }\r\n    );\r\n  }\r\n}"],"names":[],"mappings":";;;;AACA;AAAA;;AASO,eAAe,IAAI,OAAoB;IAC5C,IAAI;QACF,MAAM,cAAc;QACpB,QAAQ,GAAG,CAAC,CAAC,qBAAqB,EAAE,aAAa;QAEjD,MAAM,MAAM,MAAM,MAAM,aAAa;YACnC,SAAS;gBAAE,cAAc;YAAsC;QACjE;QAEA,IAAI,CAAC,IAAI,EAAE,EAAE,MAAM,IAAI,MAAM,CAAC,KAAK,EAAE,IAAI,MAAM,CAAC,EAAE,EAAE,IAAI,UAAU,EAAE;QAEpE,MAAM,OAAO,MAAM,IAAI,IAAI;QAC3B,MAAM,IAAI,0LAAY,CAAC;QAEvB,MAAM,SAIF;YACF,YAAY,EAAE;YACd,SAAS,EAAE;YACX,aAAa,EAAE;QACjB;QAEA,2BAA2B;QAC3B,MAAM,eAAe,CAAC;YACpB,IAAI,CAAC,KAAK,OAAO;YACjB,MAAM,OAAO;YACb,OAAO,IAAI,UAAU,CAAC,UAAU,MAAM,OAAO,CAAC,IAAI,UAAU,CAAC,OAAO,MAAM,MAAM,GAAG;QACrF;QAEA,6DAA6D;QAC7D,MAAM,yBAAyB,CAAC;YAC9B,MAAM,UAAU,EAAE,CAAC,gBAAgB,CAAC,EAAE,MAAM,CAAC,CAAC,GAAG;gBAC/C,OAAO,EAAE,IAAI,IAAI,CAAC,YAAY,IAAI,GAAG,IAAI,OAAO;YAClD;YAEA,MAAM,QAAqB,EAAE;YAC7B,QAAQ,IAAI,CAAC,yBAAyB,IAAI,CAAC,CAAC,GAAG;gBAC7C,MAAM,MAAM,EAAE;gBACd,MAAM,SAAS,IAAI,IAAI,CAAC;gBACxB,MAAM,QAAQ,IAAI,IAAI,CAAC,WAAW,IAAI,GAAG,IAAI,MAAM,OAAO,IAAI,CAAC,OAAO,IAAI,CAAC,QAAQ,UAAU;gBAC7F,MAAM,MAAM,OAAO,IAAI,CAAC,OAAO,IAAI,CAAC,QAAQ,UAAU;gBACtD,MAAM,MAAM,OAAO,IAAI,CAAC,SAAS,UAAU;gBAC3C,MAAM,YAAY,IAAI,IAAI,CAAC,SAAS,KAAK,GAAG,IAAI,GAAG,IAAI,MAAM;gBAE7D,IAAI,SAAS,OAAO,KAAK;oBACvB,MAAM,IAAI,CAAC;wBACT;wBACA,KAAK,aAAa;wBAClB,KAAK,aAAa;wBAClB;oBACF;gBACF;YACF;YACA,OAAO;QACT;QAEA,uBAAuB;QACvB,OAAO,UAAU,GAAG,uBAAuB;QAC3C,OAAO,OAAO,GAAG,uBAAuB;QACxC,OAAO,WAAW,GAAG,uBAAuB;QAE5C,OAAO,IAAI,SAAS,KAAK,SAAS,CAAC,QAAQ,MAAM,IAAI;YACnD,QAAQ;YACR,SAAS;gBAAE,gBAAgB;YAAkC;QAC/D;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,wBAAwB;QACtC,OAAO,IAAI,SACT,KAAK,SAAS,CAAC;YACb,OAAO;YACP,SAAS,AAAC,MAAgB,OAAO;QACnC,IACA;YAAE,QAAQ;YAAK,SAAS;gBAAE,gBAAgB;YAAkC;QAAE;IAElF;AACF"}}]
}