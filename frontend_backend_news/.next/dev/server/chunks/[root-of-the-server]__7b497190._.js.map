{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 82, "column": 0}, "map": {"version":3,"sources":["file:///D:/1ky-1-nam-4/frontend_backend_news/src/app/api/bongdaplus/route.ts"],"sourcesContent":["import Parser from 'rss-parser';\r\n\r\ninterface Article {\r\n  title: string;\r\n  link: string;\r\n  pubDate: string;\r\n  summary: string;\r\n  source: 'Bongdaplus';\r\n}\r\n\r\ninterface ApiResponse {\r\n  success: boolean;\r\n  data?: Article[];\r\n  error?: string;\r\n}\r\n\r\nconst RSS_FEED_URL = 'https://bongdaplus.vn/rss/news.rss'; // ‚úÖ ƒê√É X√ìA KHO·∫¢NG TR·∫ÆNG\r\n\r\n// H√†m l√†m s·∫°ch XML kh√¥ng h·ª£p l·ªá\r\nfunction sanitizeXml(xml: string): string {\r\n  // 1. Lo·∫°i b·ªè comment HTML n·∫øu c√≥\r\n  xml = xml.replace(/<!--[\\s\\S]*?-->/g, '');\r\n\r\n  // 2. S·ª≠a c√°c thu·ªôc t√≠nh kh√¥ng c√≥ d·∫•u nh√°y: width=100 ‚Üí width=\"100\"\r\n  xml = xml.replace(/(\\w+)=([^\"'\\s>]+)/g, '$1=\"$2\"');\r\n\r\n  // 3. Escape c√°c k√Ω t·ª± ƒë·∫∑c bi·ªát trong CDATA (n·∫øu c·∫ßn)\r\n  xml = xml.replace(/&(?![a-zA-Z0-9#]{1,20};)/g, '&amp;');\r\n\r\n  // 4. ƒê·∫£m b·∫£o th·∫ª <description> kh√¥ng ch·ª©a XML kh√¥ng h·ª£p l·ªá ‚Üí b·ªçc trong CDATA\r\n  xml = xml.replace(/<description>([\\s\\S]*?)<\\/description>/g, (match, content) => {\r\n    // Lo·∫°i b·ªè c√°c th·∫ª XML kh√¥ng h·ª£p l·ªá b√™n trong description\r\n    const cleanContent = content\r\n      .replace(/&(?![a-zA-Z0-9#]{1,20};)/g, '&amp;')\r\n      .replace(/</g, '&lt;')\r\n      .replace(/>/g, '&gt;');\r\n    return `<description><![CDATA[${cleanContent}]]></description>`;\r\n  });\r\n\r\n  return xml;\r\n}\r\n\r\nconst parser = new Parser({\r\n  customFields: {\r\n    item: [['content:encoded', 'content']],\r\n  },\r\n});\r\n\r\nconst MAX_ARTICLES = 10;\r\n\r\nexport async function GET(): Promise<Response> {\r\n  try {\r\n    const response = await fetch(RSS_FEED_URL, {\r\n      headers: {\r\n        'User-Agent': 'Mozilla/5.0 (compatible; RSS Reader; +https://yourproject.com)',\r\n      },\r\n    });\r\n\r\n    if (!response.ok) {\r\n      throw new Error(`HTTP ${response.status}`);\r\n    }\r\n\r\n    let rawXml = await response.text();\r\n\r\n    // üî• L√†m s·∫°ch XML tr∆∞·ªõc khi parse\r\n    const cleanXml = sanitizeXml(rawXml);\r\n\r\n    const feed = await parser.parseString(cleanXml);\r\n\r\n    if (!feed.items?.length) {\r\n      return Response.json({ success: false, error: 'No items in feed' } satisfies ApiResponse, { status: 500 });\r\n    }\r\n\r\n    const articles: Article[] = feed.items\r\n      .slice(0, MAX_ARTICLES)\r\n      .map((item) => ({\r\n        title: item.title?.trim() || 'Untitled',\r\n        link: item.link || '',\r\n        pubDate: item.pubDate ? new Date(item.pubDate).toISOString() : new Date().toISOString(),\r\n        summary: (item.contentSnippet || item.content || '').replace(/<[^>]*>/g, '').trim() || 'No summary',\r\n        source: 'Bongdaplus' as const,\r\n      }));\r\n\r\n    return Response.json({ success: true, data: articles } satisfies ApiResponse, {\r\n      status: 200,\r\n      headers: {\r\n        'Content-Type': 'application/json',\r\n        'Cache-Control': 's-maxage=300, stale-while-revalidate',\r\n      },\r\n    });\r\n  } catch (error) {\r\n    const msg = error instanceof Error ? error.message : 'Unknown';\r\n    console.error('RSS Error:', msg);\r\n    return Response.json({ success: false, error: `Parse failed: ${msg}` } satisfies ApiResponse, { status: 500 });\r\n  }\r\n}"],"names":[],"mappings":";;;;AAAA;;AAgBA,MAAM,eAAe,sCAAsC,wBAAwB;AAEnF,gCAAgC;AAChC,SAAS,YAAY,GAAW;IAC9B,iCAAiC;IACjC,MAAM,IAAI,OAAO,CAAC,oBAAoB;IAEtC,mEAAmE;IACnE,MAAM,IAAI,OAAO,CAAC,sBAAsB;IAExC,qDAAqD;IACrD,MAAM,IAAI,OAAO,CAAC,6BAA6B;IAE/C,6EAA6E;IAC7E,MAAM,IAAI,OAAO,CAAC,2CAA2C,CAAC,OAAO;QACnE,yDAAyD;QACzD,MAAM,eAAe,QAClB,OAAO,CAAC,6BAA6B,SACrC,OAAO,CAAC,MAAM,QACd,OAAO,CAAC,MAAM;QACjB,OAAO,CAAC,sBAAsB,EAAE,aAAa,iBAAiB,CAAC;IACjE;IAEA,OAAO;AACT;AAEA,MAAM,SAAS,IAAI,mJAAM,CAAC;IACxB,cAAc;QACZ,MAAM;YAAC;gBAAC;gBAAmB;aAAU;SAAC;IACxC;AACF;AAEA,MAAM,eAAe;AAEd,eAAe;IACpB,IAAI;QACF,MAAM,WAAW,MAAM,MAAM,cAAc;YACzC,SAAS;gBACP,cAAc;YAChB;QACF;QAEA,IAAI,CAAC,SAAS,EAAE,EAAE;YAChB,MAAM,IAAI,MAAM,CAAC,KAAK,EAAE,SAAS,MAAM,EAAE;QAC3C;QAEA,IAAI,SAAS,MAAM,SAAS,IAAI;QAEhC,kCAAkC;QAClC,MAAM,WAAW,YAAY;QAE7B,MAAM,OAAO,MAAM,OAAO,WAAW,CAAC;QAEtC,IAAI,CAAC,KAAK,KAAK,EAAE,QAAQ;YACvB,OAAO,SAAS,IAAI,CAAC;gBAAE,SAAS;gBAAO,OAAO;YAAmB,GAAyB;gBAAE,QAAQ;YAAI;QAC1G;QAEA,MAAM,WAAsB,KAAK,KAAK,CACnC,KAAK,CAAC,GAAG,cACT,GAAG,CAAC,CAAC,OAAS,CAAC;gBACd,OAAO,KAAK,KAAK,EAAE,UAAU;gBAC7B,MAAM,KAAK,IAAI,IAAI;gBACnB,SAAS,KAAK,OAAO,GAAG,IAAI,KAAK,KAAK,OAAO,EAAE,WAAW,KAAK,IAAI,OAAO,WAAW;gBACrF,SAAS,CAAC,KAAK,cAAc,IAAI,KAAK,OAAO,IAAI,EAAE,EAAE,OAAO,CAAC,YAAY,IAAI,IAAI,MAAM;gBACvF,QAAQ;YACV,CAAC;QAEH,OAAO,SAAS,IAAI,CAAC;YAAE,SAAS;YAAM,MAAM;QAAS,GAAyB;YAC5E,QAAQ;YACR,SAAS;gBACP,gBAAgB;gBAChB,iBAAiB;YACnB;QACF;IACF,EAAE,OAAO,OAAO;QACd,MAAM,MAAM,iBAAiB,QAAQ,MAAM,OAAO,GAAG;QACrD,QAAQ,KAAK,CAAC,cAAc;QAC5B,OAAO,SAAS,IAAI,CAAC;YAAE,SAAS;YAAO,OAAO,CAAC,cAAc,EAAE,KAAK;QAAC,GAAyB;YAAE,QAAQ;QAAI;IAC9G;AACF"}}]
}